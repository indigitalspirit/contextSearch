<!DOCTYPE html>
<html>
<head>
    <title>Search</title>
    <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="styles.css">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" language="javascript">
      
      /* POST-запрос на сервер - поиск на wikimapia, разбор и вывод результата */
      function call_in_wm() {
          var msg   = $('#search').serialize();
          $.ajax({
              type: 'POST',
              url: 'action.php',
              data: msg,

              success: function(result) {
              
                  var data = JSON.parse(result);
               
                  if(data.empty > 0) {
                      alert ('Неверный запрос!'); 
                  }
                  else 
                  {
                      $('div.info_wm').append(data["wm_url"]+data.parsed.places[0]+data.parsed.places[1]);
                      $('div.info_wm').empty();
                  
                      var i;
                      for (i = 0; i < data.parsed.places.length; i++) 
                      {
                        $('div.info_wm').append(data.parsed.places[i]);
                      }

                      $('div.log_yandex').empty();
                  
                      var j;
                      for (j = 0; j < data.parsed.urls.length; j++) 
                      {
                        $('div.log_yandex').append(data.parsed.urls[j]+"<br><hr>");
                      }
                  }
              },
              error:  function(xhr, str) {
                  alert('Возникла ошибка: ' + xhr.responseCode);
              }
            });
      }

      /* POST-запрос на сервер - поиск в базе данных, вывод результата */
      function call_in_db() {
          var msg   = $('#search').serialize();
          $.ajax({
              type: 'POST',
              url: 'action_db.php',
              data: msg,

              success: function(result) {
                var data = JSON.parse(result);
                
                if(data.empty > 0) 
                {
                  alert ('Неверный запрос!'); 
                }
                else
                {
                  $('div.info_db').html(data);
                }
              },
              error:  function(xhr, str){
                alert('Возникла ошибка: ' + xhr.responseCode);
              }
            });
      }

    </script>
</head>
<body>
	<section class="container" style="margin-top: 20px;">
    	<div class="search" style="padding-top: 20px;">
      		<h1>Поиск</h1>
      		<form id="search" method="POST" action="javascript:void(null);" >
        		<p>
        			<input type="text" name="query" id="query" value="" placeholder="Поиск">
        		</p>
            <p>
              <input type="text" name="context" id="context" value="" placeholder="Контекст">
            </p>
        		<p class="submit">
        			<input type="submit" name="commit" value="Найти(WM+Y)" onclick="call_in_wm()" >&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp<input type="submit" name="wm" value="Найти (DB)" onclick="call_in_db()"> 
       			</p>
            
      		</form>
    	</div>
  	</section> 

  	
  <section style="margin: auto; margin-top: 20px;">
    <div class="col-dsk-4 col-tab-6 col-mob-12">
    	<div class="result">
      		<h1>Поиск (wm+yandex)</h1>
      		 <div class="info_wm"></div>
    	</div>
  	</div> 
    <section style="margin: auto; margin-top: 20px;">
    <div class="col-dsk-4 col-tab-6 col-mob-12">
      <div class="result">
          <h1>Поиск (wm+yandex)</h1>
           <div class="log_yandex"></div>
      </div>
    </div> 
    <div class="col-dsk-4 col-tab-6 col-mob-12" style="float:right;">
      <div class="result">
          <h1>Поиск (DB)</h1>
           <div class="info_db"></div>
      </div>
    </div> 
    <!--section id=result_wm class="col-dsk-4"-->
    <!--div class="col-dsk-4 col-tab-6 col-mob-12">
      <div class="result">
          <h1>Поиск по контексту (yandex)</h1>
           <div class="info_gs"></div>
      </div>
    </div-->
  </section>  

</body>

</html>
